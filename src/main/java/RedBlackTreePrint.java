import java.util.*;

/**
 * @author yuweijun
 * @since 2019-05-05
 */
public class RedBlackTreePrint {

    private static final String NIL = "N";

    /**
     * <pre>
     * 可以在网页上使用 JS 动画查看红黑树的操作动画： http://www.4e00.com/algorithms/SplayTree.html
     * 也可以参考这个文章的红黑树操作截图： http://m.blog.chinaunix.net/uid-26548237-id-3480169.html
     *
     * # insert [1, 2, 3, 4, 5]
     * java RedBlackTreePrint i 1 2 3 4 5
     *
     * # remove last element, such as remove 2 from [1, 2, 3, 4, 5]
     * java RedBlackTreePrint r 1 2 3 4 5 2
     * </pre>
     */
    public static void main(String[] args) {
        int length = args.length;
        if (length < 2) {
            return;
        }

        RedBlackTreePrint printer = new RedBlackTreePrint();
        RedBlackTree<Integer> tree = new RedBlackTree<>();

        String op = args[0];
        if (op.equalsIgnoreCase("insert") || op.equalsIgnoreCase("i")) {
            for (int i = 1; i < length; i++) {
                String arg = args[i];
                int v = Integer.parseInt(arg);
                tree.insert(v);
                printer.print(tree, "insert " + v);
            }
        }

        if (op.equalsIgnoreCase("remove") || op.equalsIgnoreCase("r")) {
            for (int i = 1; i < length - 1; i++) {
                String arg = args[i];
                int v = Integer.parseInt(arg);
                tree.insert(v);
                printer.print(tree, "insert " + v);
            }
            int last = Integer.parseInt(args[length - 1]);
            tree.remove(last);
            printer.print(tree, "remove " + last);
        }
    }

    static final class NodeInfo {

        boolean left;
        int column;
        int offsetLeft;
        int offsetRight;
        String text;
        RedBlackTreePrint.NodeInfo parent;

        NodeInfo(boolean left, RedBlackTreePrint.NodeInfo parent) {
            this.left = left;
            this.parent = parent;
        }
    }

    private Map<Integer, List<NodeInfo>> maps = new HashMap<>();

    public <K extends Comparable<K>> void print(RedBlackTree<K> tree, String... args) {
        final int initOffset = 6 * maxWidth(tree.root);
        traversal(0, initOffset, true, tree.root, null);
        maps.forEach((key, list) -> {
            int position = 0;
            for (NodeInfo info : list) {
                if (info.text != null) {
                    while (position < info.offsetLeft) {
                        position = updateCursorPosition(position, ' ');
                    }
                    if (info.text.endsWith(NIL)) {
                        for (int i = 0; i < info.column; i++) {
                            position = updateCursorPosition(position, ' ');
                        }
                    } else {
                        position = updateCursorPosition(position, '┌');
                        for (int i = 1; i < info.column; i++) {
                            position = updateCursorPosition(position, '─');
                        }
                    }

                    System.out.print(info.text);
                    position += info.text.length();

                    if (!info.text.endsWith(NIL)) {
                        for (int i = 1; i < info.column; i++) {
                            position = updateCursorPosition(position, '─');
                        }
                        position = updateCursorPosition(position, '┐');
                    }
                }
            }
            System.out.println();
        });

        System.out.println(String.join(" ", args));
        for (int i = 0; i < 200; i++) {
            System.out.print('.');
        }
        System.out.println("\n");
    }

    private <K extends Comparable<K>> int maxWidth(RedBlackTree.Node<K> root) {
        if (root == null) return 0;
        Deque<RedBlackTree.Node> deque = new LinkedList<>();
        deque.offer(root);
        int max = 1;
        while (!deque.isEmpty()) {
            Deque<RedBlackTree.Node> next = new LinkedList<>();
            int size = 0;
            while (!deque.isEmpty()) {
                RedBlackTree.Node node = deque.poll();
                if (node.left != null) {
                    size++;
                    next.offer(node.left);
                } else {
                    size++;
                }
                if (node.right != null) {
                    size++;
                    next.offer(node.right);
                } else {
                    size++;
                }
            }
            if (size > max) {
                max = size;
                // next.stream().forEach(node -> System.out.printf("%-4d ", node.val));
                // System.out.println();
            }
            deque = next;
        }

        return max;
    }

    private <K extends Comparable<K>> void traversal(int row, int column, boolean left, RedBlackTree.Node<K> node, NodeInfo parent) {
        List<NodeInfo> list = maps.computeIfAbsent(row, ArrayList::new);

        if (node == null) {
            NodeInfo info = new NodeInfo(left, parent);
            info.column = column / 2;
            if (parent != null) {
                info.text = NIL;
                list.add(info);

                updateInfoOffset(left, info, parent);
                traversal(row + 1, info.column, true, null, null);
                traversal(row + 1, info.column, false, null, null);
            }
        } else {
            RedBlackTree.Node<K> leftNode = node.left;
            RedBlackTree.Node<K> rightNode = node.right;
            boolean color = node.color;
            K key = node.key;

            if (parent == null) {
                NodeInfo root = new NodeInfo(left, null);
                String text = String.format("B%s", key);
                root.text = text;
                root.parent = root;
                root.column = column / 2;
                root.offsetLeft = column * 2 / 4;
                root.offsetRight = column * 2 / 4 * 3 + text.length() - 1; // 右节点显示位置左移一个字符
                list.add(root);

                traversal(row + 1, root.column, true, leftNode, root);
                traversal(row + 1, root.column, false, rightNode, root);
            } else {
                NodeInfo info = new NodeInfo(left, parent);
                info.text = String.format("%s%s", color ? "B" : "R", key);
                info.column = column / 2;
                list.add(info);
                updateInfoOffset(left, info, parent);

                traversal(row + 1, info.column, true, leftNode, info);
                traversal(row + 1, info.column, false, rightNode, info);
            }
        }
    }

    private void updateInfoOffset(boolean left, NodeInfo info, NodeInfo parent) {
        if (left) {
            info.offsetLeft = parent.offsetLeft - info.column;
            info.offsetRight = parent.offsetLeft + info.column + info.text.length() - 1; // 右节点显示位置左移一个字符
        } else {
            info.offsetLeft = parent.offsetRight - info.column;
            info.offsetRight = parent.offsetRight + info.column + info.text.length() - 1; // 右节点显示位置左移一个字符
        }
    }

    private int updateCursorPosition(int position, char c) {
        System.out.print(c);
        position++;
        return position;
    }

}

// 运行结果如下
// ........................................................................................................................................................................................................
//
//       ┌─────B12─────┐
//       N             N
//
// insert 12 finished.
// ........................................................................................................................................................................................................
//
//       ┌─────B12─────┐
//    ┌──R1──┐         N
//    N      N
//
// insert 1 finished.
// ........................................................................................................................................................................................................
//
//             ┌───────────B9───────────┐
//       ┌─────R1─────┐           ┌─────R12─────┐
//       N            N           N             N
//
// insert 9 finished.
// ........................................................................................................................................................................................................
//
//             ┌───────────B9───────────┐
//       ┌─────B1─────┐           ┌─────B12─────┐
//       N         ┌──R2──┐       N             N
//                 N      N
//
// insert 2 finished.
// ........................................................................................................................................................................................................
//
//             ┌───────────B9───────────┐
//       ┌─────B1─────┐           ┌─────B12─────┐
//    ┌──R0──┐     ┌──R2──┐       N             N
//    N      N     N      N
//
// insert 0 finished.
// ........................................................................................................................................................................................................
//
//                   ┌─────────────────B9─────────────────┐
//          ┌────────B1────────┐                 ┌────────B12────────┐
//      ┌───R0───┐         ┌───R2───┐        ┌───R11───┐             N
//      N        N         N        N        N         N
//
// insert 11 finished.
// ........................................................................................................................................................................................................
//
//                   ┌─────────────────B9─────────────────┐
//          ┌────────R1────────┐                 ┌────────B12────────┐
//      ┌───B0───┐         ┌───B2───┐        ┌───R11───┐             N
//      N        N         N      ┌─R7─┐     N         N
//                                N    N
//
// insert 7 finished.
// ........................................................................................................................................................................................................
//
//                         ┌───────────────────────B9───────────────────────┐
//             ┌───────────R1───────────┐                       ┌───────────B12───────────┐
//       ┌─────B0─────┐           ┌─────B2─────┐          ┌─────R11─────┐           ┌─────R19─────┐
//       N            N           N         ┌──R7──┐      N             N           N             N
//                                          N      N
//
// insert 19 finished.
// ........................................................................................................................................................................................................
//
//                         ┌───────────────────────B9───────────────────────┐
//             ┌───────────R1───────────┐                       ┌───────────B12───────────┐
//       ┌─────B0─────┐           ┌─────B4─────┐          ┌─────R11─────┐           ┌─────R19─────┐
//       N            N        ┌──R2──┐     ┌──R7──┐      N             N           N             N
//                             N      N     N      N
//
// insert 4 finished.
// ........................................................................................................................................................................................................
//
//                         ┌───────────────────────B9───────────────────────┐
//             ┌───────────R1───────────┐                       ┌───────────R12───────────┐
//       ┌─────B0─────┐           ┌─────B4─────┐          ┌─────B11─────┐           ┌─────B19─────┐
//       N            N        ┌──R2──┐     ┌──R7──┐      N             N        ┌──R15──┐        N
//                             N      N     N      N                             N       N
//
// insert 15 finished.
// ........................................................................................................................................................................................................
//
//                         ┌───────────────────────B9───────────────────────┐
//             ┌───────────R1───────────┐                       ┌───────────R12───────────┐
//       ┌─────B0─────┐           ┌─────B4─────┐          ┌─────B11─────┐           ┌─────B18─────┐
//       N            N        ┌──R2──┐     ┌──R7──┐      N             N        ┌──R15──┐     ┌──R19──┐
//                             N      N     N      N                             N       N     N       N
//
// insert 18 finished.
// ........................................................................................................................................................................................................
//
//                         ┌───────────────────────B9───────────────────────┐
//             ┌───────────B1───────────┐                       ┌───────────B12───────────┐
//       ┌─────B0─────┐           ┌─────R4─────┐          ┌─────B11─────┐           ┌─────B18─────┐
//       N            N        ┌──B2──┐     ┌──B7──┐      N             N        ┌──R15──┐     ┌──R19──┐
//                             N      N    ┌R5┐    N                             N       N     N       N
//                                         N  N
//
// insert 5 finished.
// ........................................................................................................................................................................................................
//
//                         ┌───────────────────────B9───────────────────────┐
//             ┌───────────B1───────────┐                       ┌───────────B12───────────┐
//       ┌─────B0─────┐           ┌─────R4─────┐          ┌─────B11─────┐           ┌─────R18─────┐
//       N            N        ┌──B2──┐     ┌──B7──┐      N             N        ┌──B15──┐     ┌──B19──┐
//                             N      N    ┌R5┐    N                            ┌R14┐    N     N       N
//                                         N  N                                 N   N
//
// insert 14 finished.
// ........................................................................................................................................................................................................
//
//                         ┌───────────────────────B9───────────────────────┐
//             ┌───────────B1───────────┐                       ┌───────────B12───────────┐
//       ┌─────B0─────┐           ┌─────R4─────┐          ┌─────B11─────┐           ┌─────R18─────┐
//       N            N        ┌──B2──┐     ┌──B7──┐      N             N        ┌──B14──┐     ┌──B19──┐
//                             N      N    ┌R5┐    N                            ┌R13┐   ┌R15┐  N       N
//                                         N  N                                 N   N   N   N
//
// insert 13 finished.
// ........................................................................................................................................................................................................
//
//                               ┌─────────────────────────────B9─────────────────────────────┐
//                ┌──────────────B1──────────────┐                             ┌──────────────B12──────────────┐
//         ┌──────B0──────┐               ┌──────R4──────┐              ┌──────B11──────┐               ┌──────R18──────┐
//         N              N            ┌──B2──┐       ┌──B7──┐       ┌──R10──┐          N            ┌──B14──┐       ┌──B19──┐
//                                     N      N      ┌R5┐    N       N       N                      ┌R13┐   ┌R15┐    N       N
//                                                   N  N                                           N   N   N   N
//
// insert 10 finished.
// ........................................................................................................................................................................................................
//
//                                     ┌───────────────────────────────────B9───────────────────────────────────┐
//                   ┌─────────────────B1─────────────────┐                                   ┌─────────────────B14─────────────────┐
//          ┌────────B0────────┐                 ┌────────R4────────┐                ┌────────R12────────┐                 ┌────────R18────────┐
//          N                  N             ┌───B2───┐         ┌───B7───┐       ┌───B11───┐         ┌───B13───┐       ┌───B15───┐         ┌───B19───┐
//                                           N        N       ┌─R5─┐     N     ┌─R10─┐     N         N         N       N       ┌─R16─┐     N         N
//                                                            N    N           N     N                                         N     N
//
// insert 16 finished.
// ........................................................................................................................................................................................................
//
//                                     ┌───────────────────────────────────B9───────────────────────────────────┐
//                   ┌─────────────────B1─────────────────┐                                   ┌─────────────────B14─────────────────┐
//          ┌────────B0────────┐                 ┌────────R4────────┐                ┌────────R12────────┐                 ┌────────R18────────┐
//          N                  N             ┌───B2───┐         ┌───B6───┐       ┌───B11───┐         ┌───B13───┐       ┌───B15───┐         ┌───B19───┐
//                                           N        N       ┌─R5─┐   ┌─R7─┐  ┌─R10─┐     N         N         N       N       ┌─R16─┐     N         N
//                                                            N    N   N    N  N     N                                         N     N
//
// insert 6 finished.
// ........................................................................................................................................................................................................
//
//                                     ┌───────────────────────────────────B9───────────────────────────────────┐
//                   ┌─────────────────B1─────────────────┐                                   ┌─────────────────B14─────────────────┐
//          ┌────────B0────────┐                 ┌────────R4────────┐                ┌────────R12────────┐                 ┌────────R18────────┐
//          N                  N             ┌───B2───┐         ┌───B6───┐       ┌───B11───┐         ┌───B13───┐       ┌───B15───┐         ┌───B19───┐
//                                           N      ┌─R3─┐    ┌─R5─┐   ┌─R7─┐  ┌─R10─┐     N         N         N       N       ┌─R16─┐     N         N
//                                                  N    N    N    N   N    N  N     N                                         N     N
//
// insert 3 finished.
// ........................................................................................................................................................................................................
//
//                                                 ┌───────────────────────────────────────────────B9───────────────────────────────────────────────┐
//                         ┌───────────────────────B4───────────────────────┐                                               ┌───────────────────────B14───────────────────────┐
//             ┌───────────R1───────────┐                       ┌───────────R6───────────┐                      ┌───────────R12───────────┐                       ┌───────────R18───────────┐
//       ┌─────B0─────┐           ┌─────B2─────┐          ┌─────B5─────┐           ┌─────B7─────┐         ┌─────B11─────┐           ┌─────B13─────┐         ┌─────B15─────┐           ┌─────B19─────┐
//       N            N           N         ┌──R3──┐      N            N           N         ┌──R8──┐  ┌──R10──┐        N           N             N         N          ┌──R16──┐      N             N
//                                          N      N                                         N      N  N       N                                                       N       N
//
// insert 8 finished.
// ........................................................................................................................................................................................................
//
//                                                 ┌───────────────────────────────────────────────B9───────────────────────────────────────────────┐
//                         ┌───────────────────────B4───────────────────────┐                                               ┌───────────────────────B14───────────────────────┐
//             ┌───────────R1───────────┐                       ┌───────────R6───────────┐                      ┌───────────R12───────────┐                       ┌───────────R18───────────┐
//       ┌─────B0─────┐           ┌─────B2─────┐          ┌─────B5─────┐           ┌─────B7─────┐         ┌─────B11─────┐           ┌─────B13─────┐         ┌─────B16─────┐           ┌─────B19─────┐
//       N            N           N         ┌──R3──┐      N            N           N         ┌──R8──┐  ┌──R10──┐        N           N             N      ┌──R15──┐     ┌──R17──┐      N             N
//                                          N      N                                         N      N  N       N                                         N       N     N       N
//
// insert 17 finished.
// ........................................................................................................................................................................................................
//
//                                                 ┌───────────────────────────────────────────────B9───────────────────────────────────────────────┐
//                         ┌───────────────────────B4───────────────────────┐                                               ┌───────────────────────B14───────────────────────┐
//             ┌───────────R1───────────┐                       ┌───────────R6───────────┐                      ┌───────────R11───────────┐                       ┌───────────R18───────────┐
//       ┌─────B0─────┐           ┌─────B2─────┐          ┌─────B5─────┐           ┌─────B7─────┐         ┌─────B10─────┐           ┌─────B13─────┐         ┌─────B16─────┐           ┌─────B19─────┐
//       N            N           N         ┌──R3──┐      N            N           N         ┌──R8──┐     N             N           N             N      ┌──R15──┐     ┌──R17──┐      N             N
//                                          N      N                                         N      N                                                    N       N     N       N
//
// delete 12 finished.
// ........................................................................................................................................................................................................
//
//                                                 ┌───────────────────────────────────────────────B9───────────────────────────────────────────────┐
//                         ┌───────────────────────B4───────────────────────┐                                               ┌───────────────────────B14───────────────────────┐
//             ┌───────────R2───────────┐                       ┌───────────R6───────────┐                      ┌───────────R11───────────┐                       ┌───────────R18───────────┐
//       ┌─────B0─────┐           ┌─────B3─────┐          ┌─────B5─────┐           ┌─────B7─────┐         ┌─────B10─────┐           ┌─────B13─────┐         ┌─────B16─────┐           ┌─────B19─────┐
//       N            N           N            N          N            N           N         ┌──R8──┐     N             N           N             N      ┌──R15──┐     ┌──R17──┐      N             N
//                                                                                           N      N                                                    N       N     N       N
//
// delete 1 finished.
// ........................................................................................................................................................................................................
//
//                                           ┌─────────────────────────────────────────B10─────────────────────────────────────────┐
//                      ┌────────────────────B4────────────────────┐                                          ┌────────────────────B14────────────────────┐
//            ┌─────────R2─────────┐                     ┌─────────R6─────────┐                     ┌─────────B11─────────┐                     ┌─────────R18─────────┐
//       ┌────B0────┐         ┌────B3────┐          ┌────B5────┐         ┌────B7────┐               N                ┌────R13────┐         ┌────B16────┐         ┌────B19────┐
//       N          N         N          N          N          N         N        ┌─R8─┐                             N           N       ┌─R15─┐     ┌─R17─┐     N           N
//                                                                                N    N                                                 N     N     N     N
//
// delete 9 finished.
// ........................................................................................................................................................................................................
//
//                                     ┌───────────────────────────────────B10───────────────────────────────────┐
//                   ┌─────────────────B4─────────────────┐                                    ┌─────────────────B14─────────────────┐
//          ┌────────B3────────┐                 ┌────────R6────────┐                 ┌────────B11────────┐                 ┌────────R18────────┐
//      ┌───R0───┐             N             ┌───B5───┐         ┌───B7───┐            N               ┌───R13───┐       ┌───B16───┐         ┌───B19───┐
//      N        N                           N        N         N      ┌─R8─┐                         N         N     ┌─R15─┐   ┌─R17─┐     N         N
//                                                                     N    N                                         N     N   N     N
//
// delete 2 finished.
// ........................................................................................................................................................................................................
//
//                               ┌─────────────────────────────B10─────────────────────────────┐
//                ┌──────────────B4──────────────┐                              ┌──────────────B14──────────────┐
//         ┌──────B3──────┐               ┌──────R6──────┐               ┌──────B11──────┐               ┌──────R18──────┐
//         N              N            ┌──B5──┐       ┌──B7──┐           N            ┌──R13──┐       ┌──B16──┐       ┌──B19──┐
//                                     N      N       N     ┌R8┐                      N       N      ┌R15┐   ┌R17┐    N       N
//                                                          N  N                                     N   N   N   N
//
// delete 0 finished.
// ........................................................................................................................................................................................................
//
//                         ┌───────────────────────B10───────────────────────┐
//             ┌───────────B4───────────┐                        ┌───────────B14───────────┐
//       ┌─────B3─────┐           ┌─────R6─────┐           ┌─────B13─────┐           ┌─────R18─────┐
//       N            N        ┌──B5──┐     ┌──B7──┐       N             N        ┌──B16──┐     ┌──B19──┐
//                             N      N     N     ┌R8┐                           ┌R15┐   ┌R17┐  N       N
//                                                N  N                           N   N   N   N
//
// delete 11 finished.
// ........................................................................................................................................................................................................
//
//                         ┌───────────────────────B10───────────────────────┐
//             ┌───────────B4───────────┐                        ┌───────────B14───────────┐
//       ┌─────B3─────┐           ┌─────R6─────┐           ┌─────B13─────┐           ┌─────R18─────┐
//       N            N        ┌──B5──┐     ┌──B8──┐       N             N        ┌──B16──┐     ┌──B19──┐
//                             N      N     N      N                             ┌R15┐   ┌R17┐  N       N
//                                                                               N   N   N   N
//
// delete 7 finished.
// ........................................................................................................................................................................................................
//
//                         ┌───────────────────────B10───────────────────────┐
//             ┌───────────B4───────────┐                        ┌───────────B14───────────┐
//       ┌─────B3─────┐           ┌─────R6─────┐           ┌─────B13─────┐           ┌─────R16─────┐
//       N            N        ┌──B5──┐     ┌──B8──┐       N             N        ┌──B15──┐     ┌──B18──┐
//                             N      N     N      N                              N       N    ┌R17┐    N
//                                                                                             N   N
//
// delete 19 finished.
// ........................................................................................................................................................................................................
//
//                         ┌───────────────────────B10───────────────────────┐
//             ┌───────────B5───────────┐                        ┌───────────B14───────────┐
//       ┌─────B3─────┐           ┌─────B6─────┐           ┌─────B13─────┐           ┌─────R16─────┐
//       N            N           N         ┌──R8──┐       N             N        ┌──B15──┐     ┌──B18──┐
//                                          N      N                              N       N    ┌R17┐    N
//                                                                                             N   N
//
// delete 4 finished.
// ........................................................................................................................................................................................................
//
//                         ┌───────────────────────B10───────────────────────┐
//             ┌───────────B5───────────┐                        ┌───────────B14───────────┐
//       ┌─────B3─────┐           ┌─────B6─────┐           ┌─────B13─────┐           ┌─────R17─────┐
//       N            N           N         ┌──R8──┐       N             N        ┌──B16──┐     ┌──B18──┐
//                                          N      N                              N       N     N       N
//
// delete 15 finished.
// ........................................................................................................................................................................................................
//
//                         ┌───────────────────────B10───────────────────────┐
//             ┌───────────B5───────────┐                        ┌───────────B14───────────┐
//       ┌─────B3─────┐           ┌─────B6─────┐           ┌─────B13─────┐           ┌─────B17─────┐
//       N            N           N         ┌──R8──┐       N             N        ┌──R16──┐        N
//                                          N      N                              N       N
//
// delete 18 finished.
// ........................................................................................................................................................................................................
//
//                         ┌───────────────────────B10───────────────────────┐
//             ┌───────────B6───────────┐                        ┌───────────B14───────────┐
//       ┌─────B3─────┐           ┌─────B8─────┐           ┌─────B13─────┐           ┌─────B17─────┐
//       N            N           N            N           N             N        ┌──R16──┐        N
//                                                                                N       N
//
// delete 5 finished.
// ........................................................................................................................................................................................................
//
//                         ┌───────────────────────B10───────────────────────┐
//             ┌───────────B6───────────┐                        ┌───────────B16───────────┐
//       ┌─────B3─────┐           ┌─────B8─────┐           ┌─────B13─────┐           ┌─────B17─────┐
//       N            N           N            N           N             N           N             N
//
// delete 14 finished.
// ........................................................................................................................................................................................................
//
//                   ┌─────────────────B10─────────────────┐
//          ┌────────R6────────┐                  ┌────────B16────────┐
//      ┌───B3───┐         ┌───B8───┐             N               ┌───R17───┐
//      N        N         N        N                             N         N
//
// delete 13 finished.
// ........................................................................................................................................................................................................
//
//             ┌───────────B16───────────┐
//       ┌─────R6─────┐            ┌─────B17─────┐
//    ┌──B3──┐     ┌──B8──┐        N             N
//    N      N     N      N
//
// delete 10 finished.
// ........................................................................................................................................................................................................
//
//             ┌───────────B6───────────┐
//       ┌─────B3─────┐           ┌─────B17─────┐
//       N            N        ┌──R8──┐         N
//                             N      N
//
// delete 16 finished.
// ........................................................................................................................................................................................................
//
//             ┌───────────B8───────────┐
//       ┌─────B3─────┐           ┌─────B17─────┐
//       N            N           N             N
//
// delete 6 finished.
// ........................................................................................................................................................................................................
//
//       ┌─────B8─────┐
//       N         ┌──R17──┐
//                 N       N
//
// delete 3 finished.
// ........................................................................................................................................................................................................
//
//       ┌─────B17─────┐
//       N             N
//
// delete 8 finished.
// ........................................................................................................................................................................................................
//
//
// delete 17 finished.
// ........................................................................................................................................................................................................
//
//       ┌─────B12─────┐
//       N             N
//
// insert 12 finished.
// ........................................................................................................................................................................................................
//
//       ┌─────B12─────┐
//    ┌──R1──┐         N
//    N      N
//
// insert 1 finished.
// ........................................................................................................................................................................................................
//
//             ┌───────────B9───────────┐
//       ┌─────R1─────┐           ┌─────R12─────┐
//       N            N           N             N
//
// insert 9 finished.
// ........................................................................................................................................................................................................
//
//             ┌───────────B9───────────┐
//       ┌─────B1─────┐           ┌─────B12─────┐
//       N         ┌──R2──┐       N             N
//                 N      N
//
// insert 2 finished.
// ........................................................................................................................................................................................................
//
//             ┌───────────B9───────────┐
//       ┌─────B1─────┐           ┌─────B12─────┐
//    ┌──R0──┐     ┌──R2──┐       N             N
//    N      N     N      N
//
// insert 0 finished.
// ........................................................................................................................................................................................................
//
//                   ┌─────────────────B9─────────────────┐
//          ┌────────B1────────┐                 ┌────────B12────────┐
//      ┌───R0───┐         ┌───R2───┐        ┌───R11───┐             N
//      N        N         N        N        N         N
//
// insert 11 finished.
// ........................................................................................................................................................................................................
//
//                   ┌─────────────────B9─────────────────┐
//          ┌────────R1────────┐                 ┌────────B12────────┐
//      ┌───B0───┐         ┌───B2───┐        ┌───R11───┐             N
//      N        N         N      ┌─R7─┐     N         N
//                                N    N
//
// insert 7 finished.
// ........................................................................................................................................................................................................
//
//                         ┌───────────────────────B9───────────────────────┐
//             ┌───────────R1───────────┐                       ┌───────────B12───────────┐
//       ┌─────B0─────┐           ┌─────B2─────┐          ┌─────R11─────┐           ┌─────R19─────┐
//       N            N           N         ┌──R7──┐      N             N           N             N
//                                          N      N
//
// insert 19 finished.
// ........................................................................................................................................................................................................
//
//                         ┌───────────────────────B9───────────────────────┐
//             ┌───────────R1───────────┐                       ┌───────────B12───────────┐
//       ┌─────B0─────┐           ┌─────B4─────┐          ┌─────R11─────┐           ┌─────R19─────┐
//       N            N        ┌──R2──┐     ┌──R7──┐      N             N           N             N
//                             N      N     N      N
//
// insert 4 finished.
// ........................................................................................................................................................................................................
//
//                         ┌───────────────────────B9───────────────────────┐
//             ┌───────────R1───────────┐                       ┌───────────R12───────────┐
//       ┌─────B0─────┐           ┌─────B4─────┐          ┌─────B11─────┐           ┌─────B19─────┐
//       N            N        ┌──R2──┐     ┌──R7──┐      N             N        ┌──R15──┐        N
//                             N      N     N      N                             N       N
//
// insert 15 finished.
// ........................................................................................................................................................................................................
//
//                         ┌───────────────────────B9───────────────────────┐
//             ┌───────────R1───────────┐                       ┌───────────R12───────────┐
//       ┌─────B0─────┐           ┌─────B4─────┐          ┌─────B11─────┐           ┌─────B18─────┐
//       N            N        ┌──R2──┐     ┌──R7──┐      N             N        ┌──R15──┐     ┌──R19──┐
//                             N      N     N      N                             N       N     N       N
//
// insert 18 finished.
// ........................................................................................................................................................................................................
//
//                         ┌───────────────────────B9───────────────────────┐
//             ┌───────────B1───────────┐                       ┌───────────B12───────────┐
//       ┌─────B0─────┐           ┌─────R4─────┐          ┌─────B11─────┐           ┌─────B18─────┐
//       N            N        ┌──B2──┐     ┌──B7──┐      N             N        ┌──R15──┐     ┌──R19──┐
//                             N      N    ┌R5┐    N                             N       N     N       N
//                                         N  N
//
// insert 5 finished.
// ........................................................................................................................................................................................................
//
//                         ┌───────────────────────B9───────────────────────┐
//             ┌───────────B1───────────┐                       ┌───────────B12───────────┐
//       ┌─────B0─────┐           ┌─────R4─────┐          ┌─────B11─────┐           ┌─────R18─────┐
//       N            N        ┌──B2──┐     ┌──B7──┐      N             N        ┌──B15──┐     ┌──B19──┐
//                             N      N    ┌R5┐    N                            ┌R14┐    N     N       N
//                                         N  N                                 N   N
//
// insert 14 finished.
// ........................................................................................................................................................................................................
//
//                         ┌───────────────────────B9───────────────────────┐
//             ┌───────────B1───────────┐                       ┌───────────B12───────────┐
//       ┌─────B0─────┐           ┌─────R4─────┐          ┌─────B11─────┐           ┌─────R18─────┐
//       N            N        ┌──B2──┐     ┌──B7──┐      N             N        ┌──B14──┐     ┌──B19──┐
//                             N      N    ┌R5┐    N                            ┌R13┐   ┌R15┐  N       N
//                                         N  N                                 N   N   N   N
//
// insert 13 finished.
// ........................................................................................................................................................................................................
//
//                               ┌─────────────────────────────B9─────────────────────────────┐
//                ┌──────────────B1──────────────┐                             ┌──────────────B12──────────────┐
//         ┌──────B0──────┐               ┌──────R4──────┐              ┌──────B11──────┐               ┌──────R18──────┐
//         N              N            ┌──B2──┐       ┌──B7──┐       ┌──R10──┐          N            ┌──B14──┐       ┌──B19──┐
//                                     N      N      ┌R5┐    N       N       N                      ┌R13┐   ┌R15┐    N       N
//                                                   N  N                                           N   N   N   N
//
// insert 10 finished.
// ........................................................................................................................................................................................................
//
//                                     ┌───────────────────────────────────B9───────────────────────────────────┐
//                   ┌─────────────────B1─────────────────┐                                   ┌─────────────────B14─────────────────┐
//          ┌────────B0────────┐                 ┌────────R4────────┐                ┌────────R12────────┐                 ┌────────R18────────┐
//          N                  N             ┌───B2───┐         ┌───B7───┐       ┌───B11───┐         ┌───B13───┐       ┌───B15───┐         ┌───B19───┐
//                                           N        N       ┌─R5─┐     N     ┌─R10─┐     N         N         N       N       ┌─R16─┐     N         N
//                                                            N    N           N     N                                         N     N
//
// insert 16 finished.
// ........................................................................................................................................................................................................
//
//                                     ┌───────────────────────────────────B9───────────────────────────────────┐
//                   ┌─────────────────B1─────────────────┐                                   ┌─────────────────B14─────────────────┐
//          ┌────────B0────────┐                 ┌────────R4────────┐                ┌────────R12────────┐                 ┌────────R18────────┐
//          N                  N             ┌───B2───┐         ┌───B6───┐       ┌───B11───┐         ┌───B13───┐       ┌───B15───┐         ┌───B19───┐
//                                           N        N       ┌─R5─┐   ┌─R7─┐  ┌─R10─┐     N         N         N       N       ┌─R16─┐     N         N
//                                                            N    N   N    N  N     N                                         N     N
//
// insert 6 finished.
// ........................................................................................................................................................................................................
//
//                                     ┌───────────────────────────────────B9───────────────────────────────────┐
//                   ┌─────────────────B1─────────────────┐                                   ┌─────────────────B14─────────────────┐
//          ┌────────B0────────┐                 ┌────────R4────────┐                ┌────────R12────────┐                 ┌────────R18────────┐
//          N                  N             ┌───B2───┐         ┌───B6───┐       ┌───B11───┐         ┌───B13───┐       ┌───B15───┐         ┌───B19───┐
//                                           N      ┌─R3─┐    ┌─R5─┐   ┌─R7─┐  ┌─R10─┐     N         N         N       N       ┌─R16─┐     N         N
//                                                  N    N    N    N   N    N  N     N                                         N     N
//
// insert 3 finished.
// ........................................................................................................................................................................................................
//
//                                                 ┌───────────────────────────────────────────────B9───────────────────────────────────────────────┐
//                         ┌───────────────────────B4───────────────────────┐                                               ┌───────────────────────B14───────────────────────┐
//             ┌───────────R1───────────┐                       ┌───────────R6───────────┐                      ┌───────────R12───────────┐                       ┌───────────R18───────────┐
//       ┌─────B0─────┐           ┌─────B2─────┐          ┌─────B5─────┐           ┌─────B7─────┐         ┌─────B11─────┐           ┌─────B13─────┐         ┌─────B15─────┐           ┌─────B19─────┐
//       N            N           N         ┌──R3──┐      N            N           N         ┌──R8──┐  ┌──R10──┐        N           N             N         N          ┌──R16──┐      N             N
//                                          N      N                                         N      N  N       N                                                       N       N
//
// insert 8 finished.
// ........................................................................................................................................................................................................
//
//                                                 ┌───────────────────────────────────────────────B9───────────────────────────────────────────────┐
//                         ┌───────────────────────B4───────────────────────┐                                               ┌───────────────────────B14───────────────────────┐
//             ┌───────────R1───────────┐                       ┌───────────R6───────────┐                      ┌───────────R12───────────┐                       ┌───────────R18───────────┐
//       ┌─────B0─────┐           ┌─────B2─────┐          ┌─────B5─────┐           ┌─────B7─────┐         ┌─────B11─────┐           ┌─────B13─────┐         ┌─────B16─────┐           ┌─────B19─────┐
//       N            N           N         ┌──R3──┐      N            N           N         ┌──R8──┐  ┌──R10──┐        N           N             N      ┌──R15──┐     ┌──R17──┐      N             N
//                                          N      N                                         N      N  N       N                                         N       N     N       N
//
// insert 17 finished.
// ........................................................................................................................................................................................................
//
//                                                 ┌───────────────────────────────────────────────B9───────────────────────────────────────────────┐
//                         ┌───────────────────────B4───────────────────────┐                                               ┌───────────────────────B14───────────────────────┐
//             ┌───────────R2───────────┐                       ┌───────────R6───────────┐                      ┌───────────R12───────────┐                       ┌───────────R18───────────┐
//       ┌─────B1─────┐           ┌─────B3─────┐          ┌─────B5─────┐           ┌─────B7─────┐         ┌─────B11─────┐           ┌─────B13─────┐         ┌─────B16─────┐           ┌─────B19─────┐
//       N            N           N            N          N            N           N         ┌──R8──┐  ┌──R10──┐        N           N             N      ┌──R15──┐     ┌──R17──┐      N             N
//                                                                                           N      N  N       N                                         N       N     N       N
//
// delete 0 finished.
// ........................................................................................................................................................................................................
//
//                                           ┌─────────────────────────────────────────B9─────────────────────────────────────────┐
//                      ┌────────────────────B4────────────────────┐                                         ┌────────────────────B14────────────────────┐
//            ┌─────────B2─────────┐                     ┌─────────R6─────────┐                    ┌─────────R12─────────┐                     ┌─────────R18─────────┐
//            N               ┌────R3────┐          ┌────B5────┐         ┌────B7────┐         ┌────B11────┐         ┌────B13────┐         ┌────B16────┐         ┌────B19────┐
//                            N          N          N          N         N        ┌─R8─┐    ┌─R10─┐       N         N           N       ┌─R15─┐     ┌─R17─┐     N           N
//                                                                                N    N    N     N                                     N     N     N     N
//
// delete 1 finished.
// ........................................................................................................................................................................................................
//
//                                     ┌───────────────────────────────────B9───────────────────────────────────┐
//                   ┌─────────────────B4─────────────────┐                                   ┌─────────────────B14─────────────────┐
//          ┌────────B3────────┐                 ┌────────R6────────┐                ┌────────R12────────┐                 ┌────────R18────────┐
//          N                  N             ┌───B5───┐         ┌───B7───┐       ┌───B11───┐         ┌───B13───┐       ┌───B16───┐         ┌───B19───┐
//                                           N        N         N      ┌─R8─┐  ┌─R10─┐     N         N         N     ┌─R15─┐   ┌─R17─┐     N         N
//                                                                     N    N  N     N                               N     N   N     N
//
// delete 2 finished.
// ........................................................................................................................................................................................................
//
//                                     ┌───────────────────────────────────B9───────────────────────────────────┐
//                   ┌─────────────────B6─────────────────┐                                   ┌─────────────────B14─────────────────┐
//          ┌────────B4────────┐                 ┌────────B7────────┐                ┌────────R12────────┐                 ┌────────R18────────┐
//          N              ┌───R5───┐            N              ┌───R8───┐       ┌───B11───┐         ┌───B13───┐       ┌───B16───┐         ┌───B19───┐
//                         N        N                           N        N     ┌─R10─┐     N         N         N     ┌─R15─┐   ┌─R17─┐     N         N
//                                                                             N     N                               N     N   N     N
//
// delete 3 finished.
// ........................................................................................................................................................................................................
//
//                               ┌─────────────────────────────B9─────────────────────────────┐
//                ┌──────────────B6──────────────┐                             ┌──────────────B14──────────────┐
//         ┌──────B5──────┐               ┌──────B7──────┐              ┌──────R12──────┐               ┌──────R18──────┐
//         N              N               N           ┌──R8──┐       ┌──B11──┐       ┌──B13──┐       ┌──B16──┐       ┌──B19──┐
//                                                    N      N      ┌R10┐    N       N       N      ┌R15┐   ┌R17┐    N       N
//                                                                  N   N                           N   N   N   N
//
// delete 4 finished.
// ........................................................................................................................................................................................................
//
//                         ┌───────────────────────B9───────────────────────┐
//             ┌───────────B7───────────┐                       ┌───────────B14───────────┐
//       ┌─────B6─────┐           ┌─────B8─────┐          ┌─────R12─────┐           ┌─────R18─────┐
//       N            N           N            N       ┌──B11──┐     ┌──B13──┐   ┌──B16──┐     ┌──B19──┐
//                                                    ┌R10┐    N     N       N  ┌R15┐   ┌R17┐  N       N
//                                                    N   N                     N   N   N   N
//
// delete 5 finished.
// ........................................................................................................................................................................................................
//
//                         ┌───────────────────────B12───────────────────────┐
//             ┌───────────B9───────────┐                        ┌───────────B14───────────┐
//       ┌─────B7─────┐           ┌─────B11─────┐          ┌─────B13─────┐           ┌─────R18─────┐
//       N         ┌──R8──┐    ┌──R10──┐        N          N             N        ┌──B16──┐     ┌──B19──┐
//                 N      N    N       N                                         ┌R15┐   ┌R17┐  N       N
//                                                                               N   N   N   N
//
// delete 6 finished.
// ........................................................................................................................................................................................................
//
//                         ┌───────────────────────B12───────────────────────┐
//             ┌───────────B9───────────┐                        ┌───────────B14───────────┐
//       ┌─────B8─────┐           ┌─────B11─────┐          ┌─────B13─────┐           ┌─────R18─────┐
//       N            N        ┌──R10──┐        N          N             N        ┌──B16──┐     ┌──B19──┐
//                             N       N                                         ┌R15┐   ┌R17┐  N       N
//                                                                               N   N   N   N
//
// delete 7 finished.
// ........................................................................................................................................................................................................
//
//                         ┌───────────────────────B12───────────────────────┐
//             ┌───────────B10───────────┐                       ┌───────────B14───────────┐
//       ┌─────B9─────┐            ┌─────B11─────┐         ┌─────B13─────┐           ┌─────R18─────┐
//       N            N            N             N         N             N        ┌──B16──┐     ┌──B19──┐
//                                                                               ┌R15┐   ┌R17┐  N       N
//                                                                               N   N   N   N
//
// delete 8 finished.
// ........................................................................................................................................................................................................
//
//                         ┌───────────────────────B14───────────────────────┐
//             ┌───────────B12───────────┐                       ┌───────────B18───────────┐
//       ┌─────B10─────┐           ┌─────B13─────┐         ┌─────B16─────┐           ┌─────B19─────┐
//       N          ┌──R11──┐      N             N      ┌──R15──┐     ┌──R17──┐      N             N
//                  N       N                           N       N     N       N
//
// delete 9 finished.
// ........................................................................................................................................................................................................
//
//                         ┌───────────────────────B14───────────────────────┐
//             ┌───────────B12───────────┐                       ┌───────────B18───────────┐
//       ┌─────B11─────┐           ┌─────B13─────┐         ┌─────B16─────┐           ┌─────B19─────┐
//       N             N           N             N      ┌──R15──┐     ┌──R17──┐      N             N
//                                                      N       N     N       N
//
// delete 10 finished.
// ........................................................................................................................................................................................................
//
//                   ┌─────────────────B14─────────────────┐
//          ┌────────B12────────┐                 ┌────────R18────────┐
//          N               ┌───R13───┐       ┌───B16───┐         ┌───B19───┐
//                          N         N     ┌─R15─┐   ┌─R17─┐     N         N
//                                          N     N   N     N
//
// delete 11 finished.
// ........................................................................................................................................................................................................
//
//             ┌───────────B14───────────┐
//       ┌─────B13─────┐           ┌─────R18─────┐
//       N             N        ┌──B16──┐     ┌──B19──┐
//                             ┌R15┐   ┌R17┐  N       N
//                             N   N   N   N
//
// delete 12 finished.
// ........................................................................................................................................................................................................
//
//             ┌───────────B18───────────┐
//       ┌─────R15─────┐           ┌─────B19─────┐
//    ┌──B14──┐     ┌──B16──┐      N             N
//    N       N     N      ┌R17┐
//                         N   N
//
// delete 13 finished.
// ........................................................................................................................................................................................................
//
//             ┌───────────B18───────────┐
//       ┌─────R16─────┐           ┌─────B19─────┐
//    ┌──B15──┐     ┌──B17──┐      N             N
//    N       N     N       N
//
// delete 14 finished.
// ........................................................................................................................................................................................................
//
//             ┌───────────B18───────────┐
//       ┌─────B16─────┐           ┌─────B19─────┐
//       N          ┌──R17──┐      N             N
//                  N       N
//
// delete 15 finished.
// ........................................................................................................................................................................................................
//
//             ┌───────────B18───────────┐
//       ┌─────B17─────┐           ┌─────B19─────┐
//       N             N           N             N
//
// delete 16 finished.
// ........................................................................................................................................................................................................
//
//       ┌─────B18─────┐
//       N          ┌──R19──┐
//                  N       N
//
// delete 17 finished.
// ........................................................................................................................................................................................................
//
//       ┌─────B19─────┐
//       N             N
//
// delete 18 finished.
// ........................................................................................................................................................................................................
//
//
// delete 19 finished.
// ........................................................................................................................................................................................................
//